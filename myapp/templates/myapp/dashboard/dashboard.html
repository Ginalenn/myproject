
{% load static %}

{% block content %}

   {% include 'myapp/partials/navbar.html' %}

<div class="container-fluid">
  <header class="mb-4">
    <h2 class="fw-bold text-dark">ðŸ“Š Activity Monitoring Dashboard</h2>
    <p class="text-muted">An overview of key performance indicators and trends.</p>
  </header>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body d-flex flex-wrap align-items-center gap-2">
      <span class="fw-bold me-2">Filters:</span>
      <div class="btn-group" role="group">
        <button type="button" class="btn btn-sm btn-primary">Monthly</button>
        <button type="button" class="btn btn-sm btn-outline-secondary">Yearly</button>
      </div>
      <select class="form-select form-select-sm w-auto">
        <option selected>2024</option>
        <option>2023</option>
      </select>
      <select class="form-select form-select-sm w-auto">
        <option selected>All Months</option>
        <!-- Add other months -->
      </select>
    </div>
  </div>

  <!-- Metric Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-6 col-xl-3">
      <div class="card dash-card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="card-title text-muted">Total Activities</p>
              <h3 class="fw-bold">{{ total_activities|default:"N/A" }}</h3>
              <small class="text-success">+12% from last period</small>
            </div>
            <div class="dash-icon bg-primary text-white">
              <i class="fa-solid fa-list-check"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dash-card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="card-title text-muted">Completed</p>
              <h3 class="fw-bold">{{ completed_activities|default:"N/A" }}</h3>
              <small class="text-success">+8% from last period</small>
            </div>
            <div class="dash-icon bg-success text-white">
              <i class="fa-solid fa-check-double"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dash-card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="card-title text-muted">Avg. Impact Score</p>
              <h3 class="fw-bold">{{ average_impact }}%</h3>
              <small class="text-danger">-5% from last period</small>
            </div>
            <div class="dash-icon bg-warning text-white">
              <i class="fa-solid fa-star-half-stroke"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dash-card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="card-title text-muted">Active Strategies</p>
              <h3 class="fw-bold">{{ active_strategies|default:"N/A" }}</h3>
              <small class="text-success">+3 from last period</small>
            </div>
            <div class="dash-icon bg-danger text-white">
              <i class="fa-solid fa-bullseye"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card p-3 shadow-sm h-100">
        <h6 class="text-muted mb-3">ðŸ“ˆ Activity Trends (Last 6 Months)</h6>
        <canvas id="activityChart"></canvas>
      </div>
    </div>
    <div class="col-lg-5">
      <div class="card p-3 shadow-sm h-100">
        <h6 class="text-muted mb-3">ðŸ“Œ Strategy Usage</h6>
        <canvas id="strategyChart"></canvas>
      </div>
    </div>
  </div>
</div>

  {% endblock %}



<!-- This script block will be injected along with the HTML -->
<script>
  // Clean up old charts if they exist to prevent memory leaks
  if (window.myActivityChart) {
    window.myActivityChart.destroy();
  }
  if (window.myStrategyChart) {
    window.myStrategyChart.destroy();
  }

  // Line Chart: Activity Trends
  const activityCtx = document.getElementById('activityChart').getContext('2d');
  window.myActivityChart = new Chart(activityCtx, {
    type: 'line',
    data: {
      // Data passed from Django view
      labels: {{ activity_chart_labels|safe }},
      datasets: [{
        label: 'Activities',
        data: {{ activity_chart_data|safe }},
        borderColor: '#0d6efd',
        backgroundColor: 'rgba(13, 110, 253, 0.1)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // Doughnut Chart: Strategy Usage
  const strategyCtx = document.getElementById('strategyChart').getContext('2d');
  window.myStrategyChart = new Chart(strategyCtx, {
    type: 'doughnut',
    data: {
      // Data passed from Django view
      labels: {{ strategy_chart_labels|safe }},
      datasets: [{
        data: {{ strategy_chart_data|safe }},
        backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1'],
        hoverOffset: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            padding: 15,
            usePointStyle: true,
            pointStyle: 'circle'
          }
        }
      }
    }
  });
</script>